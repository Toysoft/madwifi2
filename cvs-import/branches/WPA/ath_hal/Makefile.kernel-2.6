
# XXX use ${ARCH}
TARGET=	i386-elf
HAL=	$(src)/../hal
EXTRA_CFLAGS+=	-I${HAL} -I${HAL}/linux

ifndef HAL_OBJDIR
#
# Use release version of HAL.
#
# NB: binary HAL's are distributed in a uuencode'd file; on some
#     systems uuencode is not installed by default and you must
#     specially install it from the sharutils package.
#
UUDECODE?=uudecode
OPT_AH_H=	opt_ah.h
EXTRA_CFLAGS+=	-I.			# for opt_ah.h

$(obj)/hal.o:	${HAL}/linux/${TARGET}.hal.o.uu
	${UUDECODE} -o $(obj)/hal.o < $<
opt_ah.h: ${HAL}/linux/${TARGET}.opt_ah.h
	cp ${HAL}/linux/${TARGET}.opt_ah.h ${HAL}/opt_ah.h
else
#
# Use private version of HAL.
#
OPT_AH_H=	${HAL_OBJDIR}/opt_ah.h
EXTRA_CFLAGS+=	-I${HAL_OBJDIR}		# for opt_ah.h
endif

$(obj)/ah_osdep.o: ${HAL}/linux/ah_osdep.c ${OPT_AH_H}
	${CC} -o $@ -c ${CFLAGS} ${EXTRA_CFLAGS} $<

obj-$(CONFIG_ATHEROS_HAL)	+= ah_osdep.o hal.o
